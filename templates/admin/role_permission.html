{% extends 'base.html' %}

{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, msg in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show d-flex justify-content-between align-items-center mr-4 mt-3" role="alert">
                {{ msg }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}
<section class="container">
    <div class="w-100 d-flex align-items-center justify-content-between flex-wrap manage-b">
        <h5 class="mb-0 management">Role Permission</h5>
        <form method="post" class="d-flex">
            <div class="users-input">
                <input type="text" placeholder="Search" name="search_text">
                <button name="search" value="clicked"><i class="fa-solid fa-magnifying-glass"></i></button>
            </div>        
        </form>
    </div>
</section>

<form class="mx-auto" style="width: 90%;" method="post">
    <section class="table-cover w-100">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>#</th>
                    {% for role in roles %}
                        <th>{{ role.role }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody> 
                {% for permission in permissions %}
                    <tr>
                        <td>{{ permission.permission }}</td>
                        {% for role in roles %}
                            {% set ns = namespace(here=False) %}
                            {% for role_perm in role_permission %}
                                {% if role_perm.role_id == role.id and role_perm.permission_id == permission.id %}
                                    {% set ns.here = True %}
                                {% endif %}
                            {% endfor %}
                            {% if ns.here %}
                                <td><input type="checkbox" checked name="role_{{ role.id }}_permission_{{ permission.id }}"></td>
                            {% else %}
                                <td><input type="checkbox" name="role_{{ role.id }}_permission_{{ permission.id }}"></td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
    <button class="btn btn-primary float-right" name="save_changes" value="clicked">Save Changes</button>
</form>
{% endblock %}